<!--pages/job-detail/job-detail.wxml-->
<view class="job-detail-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-section" wx:if="{{loading}}">
    <text class="loading-icon">â³</text>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- å²—ä½è¯¦æƒ…å†…å®¹ -->
  <view wx:if="{{!loading && jobDetail}}" class="content">
    <!-- å²—ä½å¤´éƒ¨ä¿¡æ¯ -->
    <view class="job-header">
      <view class="job-basic">
        <view class="job-title">{{jobDetail.title}}</view>
        <view class="job-salary">{{jobDetail.salary}}å…ƒ/{{jobDetail.salaryUnit}}</view>
      </view>
      <view class="job-status">
        <text class="status-tag status-{{jobDetail.urgency}}">{{jobDetail.status}}</text>
      </view>
    </view>

    <!-- ä¼ä¸šä¿¡æ¯å¡ç‰‡ -->
    <view class="company-card">
      <view class="company-header">
        <view class="company-avatar">ğŸ¢</view>
        <view class="company-info">
          <view class="company-name">{{jobDetail.companyName}}</view>
          <view class="company-location">
            <text class="location-icon">ğŸ“</text>
            <text>{{jobDetail.location}} Â· {{jobDetail.distance}}m</text>
          </view>
        </view>
        <view class="company-action">
          <button class="contact-btn" bindtap="onContactCompany">è”ç³»</button>
        </view>
      </view>
    </view>

    <!-- å·¥ä½œä¿¡æ¯ -->
    <view class="work-info-card">
      <view class="card-title">å·¥ä½œä¿¡æ¯</view>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">å·¥ä½œæ—¶é—´</text>
          <text class="info-value">{{jobDetail.workTime}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å‘å¸ƒæ—¶é—´</text>
          <text class="info-value">{{jobDetail.publishTime}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ‹›è˜äººæ•°</text>
          <text class="info-value">{{jobDetail.recruitCount || 'è‹¥å¹²'}}äºº</text>
        </view>
      </view>
    </view>

    <!-- å²—ä½æè¿° -->
    <view class="job-content-card">
      <view class="card-title">å²—ä½æè¿°</view>
      <view class="job-description">{{jobDetail.description}}</view>
    </view>

    <!-- å²—ä½è¦æ±‚ -->
    <view class="requirements-card" wx:if="{{jobDetail.requirements && jobDetail.requirements.length > 0}}">
      <view class="card-title">å²—ä½è¦æ±‚</view>
      <view class="requirements-list">
        <view class="requirement-item" wx:for="{{jobDetail.requirements}}" wx:key="*this">
          <text class="requirement-icon">âœ“</text>
          <text class="requirement-text">{{item}}</text>
        </view>
      </view>
    </view>

    <!-- ç¦åˆ©å¾…é‡ -->
    <view class="benefits-card" wx:if="{{jobDetail.benefits && jobDetail.benefits.length > 0}}">
      <view class="card-title">ç¦åˆ©å¾…é‡</view>
      <view class="benefits-list">
        <text class="benefit-tag" wx:for="{{jobDetail.benefits}}" wx:key="*this">{{item}}</text>
      </view>
    </view>

    <!-- ç›¸ä¼¼å²—ä½æ¨è -->
    <view class="similar-jobs-card" wx:if="{{similarJobs && similarJobs.length > 0}}">
      <view class="card-title">ç›¸ä¼¼å²—ä½æ¨è</view>
      <view class="similar-jobs-list">
        <view class="similar-job-item" wx:for="{{similarJobs}}" wx:key="id" bindtap="onSimilarJobTap" data-id="{{item.id}}">
          <view class="similar-job-info">
            <view class="similar-job-title">{{item.title}}</view>
            <view class="similar-job-company">{{item.companyName}}</view>
          </view>
          <view class="similar-job-salary">{{item.salary}}å…ƒ/{{item.salaryUnit}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ç”³è¯·åŒºåŸŸ -->
  <view class="apply-section" wx:if="{{!loading && jobDetail}}">
    <view class="apply-actions">
      <button class="collect-btn {{isCollected ? 'collected' : ''}}" bindtap="onToggleCollect">
        <text class="collect-icon">{{isCollected ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="collect-text">{{isCollected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </button>
      <button 
        class="apply-btn {{applying ? 'loading' : ''}}" 
        disabled="{{applying || hasApplied}}"
        bindtap="onApplyJob"
      >
        {{hasApplied ? 'å·²ç”³è¯·' : applying ? 'ç”³è¯·ä¸­...' : 'ç«‹å³ç”³è¯·'}}
      </button>
    </view>
  </view>

  <!-- ç”³è¯·æˆåŠŸå¼¹çª— -->
  <view class="success-popup {{showSuccessPopup ? 'show' : ''}}" wx:if="{{showSuccessPopup}}">
    <view class="popup-mask" bindtap="onHideSuccessPopup"></view>
    <view class="popup-content">
      <view class="success-icon">ğŸ‰</view>
      <view class="success-title">ç”³è¯·æˆåŠŸï¼</view>
      <view class="success-desc">æ‚¨çš„ç”³è¯·å·²æäº¤ï¼Œä¼ä¸šå°†åœ¨24å°æ—¶å†…å›å¤</view>
      <view class="success-actions">
        <button class="success-btn" bindtap="onViewMyApplications">æŸ¥çœ‹æˆ‘çš„ç”³è¯·</button>
        <button class="success-btn secondary" bindtap="onHideSuccessPopup">ç»§ç»­æµè§ˆ</button>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-section" wx:if="{{!loading && !jobDetail}}">
    <text class="error-icon">ğŸ˜•</text>
    <text class="error-text">å²—ä½ä¿¡æ¯åŠ è½½å¤±è´¥</text>
    <button class="retry-btn" bindtap="loadJobDetail">é‡æ–°åŠ è½½</button>
  </view>
</view>