<!--pages/jobs/jobs.wxml-->
<view class="jobs-container">
  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-bar">
      <input
        class="search-input"
        value="{{searchKeyword}}"
        placeholder="æœç´¢å²—ä½ã€ä¼ä¸šåç§°"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
    
    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="filter-bar">
      <view class="filter-item {{filters.salary ? 'active' : ''}}" bindtap="onShowFilter" data-type="salary">
        <text>è–ªèµ„{{filters.salary ? 'âœ“' : ''}}</text>
      </view>
      <view class="filter-item {{filters.distance ? 'active' : ''}}" bindtap="onShowFilter" data-type="distance">
        <text>è·ç¦»{{filters.distance ? 'âœ“' : ''}}</text>
      </view>
      <view class="filter-item {{filters.workTime ? 'active' : ''}}" bindtap="onShowFilter" data-type="workTime">
        <text>æ—¶é—´{{filters.workTime ? 'âœ“' : ''}}</text>
      </view>
      <view class="filter-item" bindtap="onShowSort">
        <text>æ’åº</text>
      </view>
    </view>
  </view>

  <!-- å²—ä½åˆ—è¡¨ -->
  <view class="jobs-list" wx:if="{{jobs.length > 0}}">
    <view 
      class="job-card" 
      wx:for="{{jobs}}" 
      wx:key="id"
      bindtap="onJobTap"
      data-job="{{item}}"
    >
      <view class="job-header">
        <view class="job-title">{{item.title}}</view>
        <view class="job-salary">{{item.salary}}å…ƒ/{{item.salaryUnit}}</view>
      </view>
      
      <view class="job-info">
        <view class="company-name">{{item.companyName}}</view>
        <view class="job-location">
          <text class="location-icon">ğŸ“</text>
          <text>{{item.location}} Â· {{item.distance}}m</text>
        </view>
      </view>
      
      <view class="job-desc">{{item.description}}</view>
      
      <view class="job-tags" wx:if="{{item.requirements && item.requirements.length > 0}}">
        <text class="job-tag" wx:for="{{item.requirements}}" wx:key="*this" wx:for-item="tag">
          {{tag}}
        </text>
      </view>
      
      <view class="job-footer">
        <view class="job-time">{{item.workTime}}</view>
        <view class="job-status">
          <text class="status-tag status-{{item.urgency}}">{{item.status}}</text>
          <text class="publish-time">{{item.publishTime}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-section" wx:if="{{loading && !refreshing}}">
    <text class="loading-icon">â³</text>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-section" wx:if="{{!loading && jobs.length === 0}}">
    <text class="empty-icon">ğŸ’¼</text>
    <text class="empty-text">æš‚æ— å²—ä½ä¿¡æ¯</text>
    <text class="empty-desc">è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨</text>
  </view>

  <!-- ç­›é€‰å¼¹çª— -->
  <view class="filter-popup {{showFilterPopup ? 'show' : ''}}" wx:if="{{showFilterPopup}}">
    <view class="popup-mask" bindtap="onHideFilter"></view>
    <view class="popup-content">
      <view class="popup-header">
        <text class="popup-title">{{currentFilterType === 'salary' ? 'è–ªèµ„ç­›é€‰' : currentFilterType === 'distance' ? 'è·ç¦»ç­›é€‰' : 'æ—¶é—´ç­›é€‰'}}</text>
        <text class="popup-close" bindtap="onHideFilter">âœ•</text>
      </view>
      
      <!-- è–ªèµ„ç­›é€‰ -->
      <view class="filter-options" wx:if="{{currentFilterType === 'salary'}}">
        <view class="filter-option {{filters.salary === '' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="salary" data-value="">
          ä¸é™
        </view>
        <view class="filter-option {{filters.salary === '100-150' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="salary" data-value="100-150">
          100-150å…ƒ/å¤©
        </view>
        <view class="filter-option {{filters.salary === '150-200' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="salary" data-value="150-200">
          150-200å…ƒ/å¤©
        </view>
        <view class="filter-option {{filters.salary === '200+' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="salary" data-value="200+">
          200å…ƒä»¥ä¸Š/å¤©
        </view>
      </view>
      
      <!-- è·ç¦»ç­›é€‰ -->
      <view class="filter-options" wx:if="{{currentFilterType === 'distance'}}">
        <view class="filter-option {{filters.distance === '' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="distance" data-value="">
          ä¸é™
        </view>
        <view class="filter-option {{filters.distance === '1000' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="distance" data-value="1000">
          1å…¬é‡Œå†…
        </view>
        <view class="filter-option {{filters.distance === '3000' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="distance" data-value="3000">
          3å…¬é‡Œå†…
        </view>
        <view class="filter-option {{filters.distance === '5000' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="distance" data-value="5000">
          5å…¬é‡Œå†…
        </view>
      </view>
      
      <!-- æ—¶é—´ç­›é€‰ -->
      <view class="filter-options" wx:if="{{currentFilterType === 'workTime'}}">
        <view class="filter-option {{filters.workTime === '' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="workTime" data-value="">
          ä¸é™
        </view>
        <view class="filter-option {{filters.workTime === 'morning' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="workTime" data-value="morning">
          ä¸Šåˆç­
        </view>
        <view class="filter-option {{filters.workTime === 'afternoon' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="workTime" data-value="afternoon">
          ä¸‹åˆç­
        </view>
        <view class="filter-option {{filters.workTime === 'evening' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="workTime" data-value="evening">
          æ™šç­
        </view>
        <view class="filter-option {{filters.workTime === 'flexible' ? 'active' : ''}}" bindtap="onSelectFilter" data-type="workTime" data-value="flexible">
          çµæ´»æ’ç­
        </view>
      </view>
    </view>
  </view>

  <!-- æ’åºå¼¹çª— -->
  <view class="sort-popup {{showSortPopup ? 'show' : ''}}" wx:if="{{showSortPopup}}">
    <view class="popup-mask" bindtap="onHideSort"></view>
    <view class="popup-content">
      <view class="popup-header">
        <text class="popup-title">æ’åºæ–¹å¼</text>
        <text class="popup-close" bindtap="onHideSort">âœ•</text>
      </view>
      
      <view class="sort-options">
        <view class="sort-option {{sortType === 'default' ? 'active' : ''}}" bindtap="onSelectSort" data-value="default">
          é»˜è®¤æ’åº
        </view>
        <view class="sort-option {{sortType === 'salary_desc' ? 'active' : ''}}" bindtap="onSelectSort" data-value="salary_desc">
          è–ªèµ„ä»é«˜åˆ°ä½
        </view>
        <view class="sort-option {{sortType === 'distance_asc' ? 'active' : ''}}" bindtap="onSelectSort" data-value="distance_asc">
          è·ç¦»ä»è¿‘åˆ°è¿œ
        </view>
        <view class="sort-option {{sortType === 'time_desc' ? 'active' : ''}}" bindtap="onSelectSort" data-value="time_desc">
          å‘å¸ƒæ—¶é—´æœ€æ–°
        </view>
      </view>
    </view>
  </view>
</view>