<!--pages/index/index.wxml-->
<view class="index-container">
  <!-- å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="header-section">
    <view class="user-card" wx:if="{{isLoggedIn}}">
      <view class="user-info">
        <image class="user-avatar" src="{{userInfo.avatar || 'https://via.placeholder.com/80x80/4A90E2/FFFFFF?text=å¤´åƒ'}}" />
        <view class="user-details">
          <view class="user-name">{{getGreeting()}}ï¼Œ{{userInfo.name || 'ç”¨æˆ·'}}</view>
          <view class="user-type">{{userType === 'worker' ? 'æ±‚èŒè€…' : 'ä¼ä¸šç”¨æˆ·'}}</view>
        </view>
      </view>
      <view class="location-info" wx:if="{{currentLocation}}">
        <text class="location-icon">ğŸ“</text>
        <text class="location-text">{{currentLocation.address || 'å®šä½ä¸­...'}}</text>
      </view>
    </view>

    <!-- æœªç™»å½•çŠ¶æ€ -->
    <view class="welcome-card" wx:if="{{!isLoggedIn}}">
      <view class="app-logo">
        <i class="bi bi-cup-hot-fill"></i>
      </view>
      <view class="welcome-text">
        <view class="app-name">é¤é¥®çµæ´»ç”¨å·¥</view>
        <view class="app-desc">è¿æ¥é¤é¥®ä¼ä¸šä¸å…¼èŒäººå‘˜</view>
      </view>
      <button class="login-btn" bindtap="onGoLogin">ç«‹å³ç™»å½•</button>
    </view>
  </view>

  <!-- å¿«æ·åŠŸèƒ½åŒºåŸŸ -->
  <view class="quick-actions-section" wx:if="{{isLoggedIn}}">
    <view class="action-grid">
      <view 
        class="action-item"
        wx:for="{{userType === 'worker' ? workerActions : companyActions}}"
        wx:key="id"
        bindtap="onActionTap"
        data-action="{{item}}"
      >
        <view class="action-icon" style="background-color: {{item.color}};">
          <i class="bi {{item.icon}}"></i>
        </view>
        <view class="action-name">{{item.name}}</view>
      </view>
    </view>
  </view>

  <!-- æ±‚èŒè€…ä¸“å±å†…å®¹ -->
  <view wx:if="{{isLoggedIn && userType === 'worker'}}">
    <!-- ä¸ªæ€§åŒ–æ¨è -->
    <view class="recommendation-section" wx:if="{{recommendedJobs.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <i class="bi bi-bullseye title-icon"></i>
          <text>ä¸ºæ‚¨æ¨è</text>
        </view>
        <view class="section-action" bindtap="onViewMoreRecommended">
          <text>æ›´å¤š</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
      
      <scroll-view class="jobs-scroll" scroll-x="true" show-scrollbar="false">
        <view class="jobs-list horizontal">
          <view 
            class="job-card horizontal"
            wx:for="{{recommendedJobs}}"
            wx:key="id"
            bindtap="onJobTap"
            data-job="{{item}}"
          >
            <view class="job-header">
              <view class="job-title">{{item.title}}</view>
              <view class="job-salary">{{item.salary}}å…ƒ/{{item.salaryUnit}}</view>
            </view>
            <view class="job-company">{{item.companyName}}</view>
            <view class="job-location">
              <text class="location-icon">ğŸ“</text>
              <text>{{item.distance}}m</text>
            </view>
            <view class="job-tags">
              <text class="job-tag" wx:for="{{item.requirements}}" wx:key="*this" wx:for-item="tag" wx:if="{{index < 2}}">
                {{tag}}
              </text>
            </view>
            <view class="match-score">
              <text class="match-text">åŒ¹é…åº¦</text>
              <text class="match-value">{{item.matchScore}}%</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- é™„è¿‘å²—ä½ -->
    <view class="nearby-section" wx:if="{{nearbyJobs.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <i class="bi bi-geo-alt-fill title-icon"></i>
          <text>é™„è¿‘å²—ä½</text>
        </view>
        <view class="section-action" bindtap="onViewMoreNearby">
          <text>æ›´å¤š</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
      
      <view class="jobs-list vertical">
        <view 
          class="job-card vertical"
          wx:for="{{nearbyJobs}}"
          wx:key="id"
          bindtap="onJobTap"
          data-job="{{item}}"
        >
          <view class="job-main">
            <view class="job-info">
              <view class="job-title">{{item.title}}</view>
              <view class="job-company">{{item.companyName}}</view>
              <view class="job-location">
                <text class="location-icon">ğŸ“</text>
                <text>{{item.location}} Â· {{item.distance}}m</text>
              </view>
            </view>
            <view class="job-salary">{{item.salary}}å…ƒ/{{item.salaryUnit}}</view>
          </view>
          <view class="job-footer">
            <view class="job-time">{{item.workTime}}</view>
            <text class="job-status status-{{item.urgency}}">{{item.status}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨å²—ä½ -->
    <view class="hot-jobs-section" wx:if="{{hotJobs.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <i class="bi bi-fire title-icon"></i>
          <text>çƒ­é—¨å²—ä½</text>
        </view>
        <view class="section-action" bindtap="onViewMoreHot">
          <text>æ›´å¤š</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
      
      <view class="hot-jobs-grid">
        <view 
          class="hot-job-item"
          wx:for="{{hotJobs}}"
          wx:key="id"
          bindtap="onJobTap"
          data-job="{{item}}"
        >
          <view class="hot-job-title">{{item.title}}</view>
          <view class="hot-job-salary">{{item.salary}}å…ƒ/{{item.salaryUnit}}</view>
          <view class="hot-job-count">{{item.applyCount}}äººç”³è¯·</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¼ä¸šç”¨æˆ·ä¸“å±å†…å®¹ -->
  <view wx:if="{{isLoggedIn && userType === 'company'}}">
    <!-- æ•°æ®æ¦‚è§ˆ -->
    <view class="stats-section">
      <view class="section-title">
        <i class="bi bi-bar-chart-fill title-icon"></i>
        <text>æ•°æ®æ¦‚è§ˆ</text>
      </view>
      
      <view class="stats-grid">
        <view class="stat-item">
          <view class="stat-number">{{companyStats.activeJobs || 0}}</view>
          <view class="stat-label">æ´»è·ƒå²—ä½</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{companyStats.todayApplications || 0}}</view>
          <view class="stat-label">ä»Šæ—¥ç”³è¯·</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{companyStats.workingStaff || 0}}</view>
          <view class="stat-label">åœ¨èŒå‘˜å·¥</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{companyStats.monthRevenue || 0}}</view>
          <view class="stat-label">æœ¬æœˆè¥æ”¶</view>
        </view>
      </view>
    </view>

    <!-- æ¨èæ±‚èŒè€… -->
    <view class="recommended-workers-section" wx:if="{{recommendedWorkers.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <i class="bi bi-people-fill title-icon"></i>
          <text>æ¨èæ±‚èŒè€…</text>
        </view>
        <view class="section-action" bindtap="onViewMoreWorkers">
          <text>æ›´å¤š</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
      
      <view class="workers-list">
        <view 
          class="worker-card"
          wx:for="{{recommendedWorkers}}"
          wx:key="id"
          bindtap="onWorkerTap"
          data-worker="{{item}}"
        >
          <image class="worker-avatar" src="{{item.avatar}}" />
          <view class="worker-info">
            <view class="worker-name">{{item.name}}</view>
            <view class="worker-experience">{{item.experience}}</view>
            <view class="worker-skills">
              <text class="skill-tag" wx:for="{{item.skills}}" wx:key="*this" wx:for-item="skill" wx:if="{{index < 3}}">
                {{skill}}
              </text>
            </view>
          </view>
          <view class="worker-rating">
            <text class="rating-score">{{item.rating}}</text>
            <text class="rating-star">â­</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-section" wx:if="{{loading}}">
    <i class="bi bi-arrow-clockwise loading-icon"></i>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-section" wx:if="{{isLoggedIn && !loading && isEmpty}}">
    <i class="bi bi-clipboard-x empty-icon"></i>
    <text class="empty-text">æš‚æ— æ¨èå†…å®¹</text>
    <text class="empty-desc">å®Œå–„ä¸ªäººèµ„æ–™å¯è·å¾—æ›´ç²¾å‡†çš„æ¨è</text>
    <button class="complete-profile-btn" bindtap="onCompleteProfile">å®Œå–„èµ„æ–™</button>
  </view>
</view>